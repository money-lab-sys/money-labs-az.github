<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0b0f19">
    <title>JETWIN | PLATFORM</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700;900&family=Rajdhani:wght@700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- 1. RESET & CORE --- */
        :root {
            --bg: #0b0f19;
            --panel: #151a27;
            --primary: #f59e0b;
            --primary-dark: #d97706;
            --green: #10b981;
            --red: #ef4444;
            --text: #ffffff;
            --border: rgba(255,255,255,0.1);
        }

        * { box-sizing: border-box; outline: none; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0; padding: 0;
            background: var(--bg);
            color: var(--text);
            font-family: 'Inter', sans-serif;
            height: 100vh; height: 100dvh; /* Mobile Fix */
            display: flex; flex-direction: column;
            overflow: hidden;
        }

        /* --- 2. AUTH SCREEN --- */
        #authScreen {
            position: fixed; inset: 0; z-index: 9999;
            background: radial-gradient(circle at top, #1e293b, #0b0f19);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            padding: 20px;
        }
        .auth-logo { font-family: 'Rajdhani'; font-size: 48px; color: var(--primary); font-weight: 900; margin-bottom: 10px; }
        .auth-box { width: 100%; max-width: 320px; background: var(--panel); padding: 20px; border-radius: 20px; border: 1px solid var(--border); }
        
        .inp {
            width: 100%; padding: 15px; margin-bottom: 10px;
            background: #0b0f19; border: 1px solid var(--border); border-radius: 12px;
            color: white; font-size: 16px; font-weight: bold;
        }
        .inp:focus { border-color: var(--primary); }
        
        .btn-auth {
            width: 100%; padding: 15px; background: linear-gradient(to right, var(--primary), var(--primary-dark));
            border: none; border-radius: 12px; color: white; font-weight: 900; font-size: 18px; cursor: pointer;
        }
        .wa-help { text-align: center; margin-top: 15px; color: var(--green); font-size: 14px; font-weight: 600; cursor: pointer; display: block; }

        /* --- 3. APP LAYOUT --- */
        #appScreen { display: none; flex-direction: column; height: 100%; width: 100%; }

        /* Header */
        .header {
            height: 60px; min-height: 60px; background: var(--panel); border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center; padding: 0 15px; z-index: 50;
        }
        .h-logo { font-family: 'Rajdhani'; font-weight: 900; font-size: 24px; color: var(--primary); }
        .h-bal { background: #0b0f19; padding: 5px 12px; border-radius: 20px; border: 1px solid var(--border); font-weight: 700; color: var(--green); font-family: 'Rajdhani'; font-size: 16px; }

        /* Main View Container */
        #mainView { flex: 1; position: relative; overflow: hidden; display: flex; flex-direction: column; }

        /* Views */
        .view { display: none; flex: 1; flex-direction: column; overflow-y: auto; height: 100%; }
        .view.active { display: flex; }

        /* --- LOBBY --- */
        .lobby-pad { padding: 15px; padding-bottom: 80px; }
        .hero-banner {
            background: linear-gradient(135deg, #f59e0b, #b45309);
            border-radius: 16px; padding: 25px; margin-bottom: 20px;
            color: white; position: relative; overflow: hidden; cursor: pointer;
            box-shadow: 0 10px 20px rgba(245, 158, 11, 0.2);
        }
        .hero-banner h2 { margin: 0; font-family: 'Rajdhani'; font-size: 32px; font-weight: 900; }
        .hero-icon { position: absolute; right: 20px; top: 50%; transform: translateY(-50%); font-size: 50px; opacity: 0.3; }

        .game-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .g-card { background: var(--panel); border-radius: 16px; padding: 20px; text-align: center; border: 1px solid var(--border); cursor: pointer; }
        .g-card:active { transform: scale(0.98); background: #1f2937; }
        .g-icon { font-size: 30px; margin-bottom: 10px; }
        .g-name { font-weight: 800; font-size: 14px; }

        /* --- JETX GAME (FIXED LAYOUT) --- */
        /* Flex column ensures controls are ALWAYS visible at bottom */
        #gameView { background: #0b0f19; }
        
        .game-stage {
            flex: 1; position: relative; overflow: hidden; width: 100%;
            background: radial-gradient(circle at center, #1e293b 0%, #0b0f19 100%);
        }
        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        
        .hud { position: absolute; top: 30%; left: 50%; transform: translate(-50%,-50%); text-align: center; pointer-events: none; }
        .hud-m { font-family: 'Rajdhani'; font-size: 64px; font-weight: 900; color: white; text-shadow: 0 0 20px rgba(0,0,0,0.5); }
        .hud-s { font-size: 12px; background: rgba(0,0,0,0.5); padding: 4px 10px; border-radius: 20px; color: #aaa; }

        .controls {
            height: auto; min-height: 140px; background: var(--panel); border-top: 1px solid var(--border);
            padding: 15px; display: flex; flex-direction: column; gap: 10px; z-index: 20;
        }
        .bet-line { display: flex; gap: 10px; }
        .b-btn { width: 50px; height: 50px; border-radius: 10px; border: none; background: #2d3748; color: white; font-size: 20px; cursor: pointer; }
        .b-inp { flex: 1; background: #0b0f19; border: 1px solid var(--border); border-radius: 10px; color: white; text-align: center; font-size: 22px; font-family: 'Rajdhani'; font-weight: bold; }
        
        .act-btn { width: 100%; height: 55px; border-radius: 12px; border: none; font-size: 20px; font-weight: 900; text-transform: uppercase; cursor: pointer; }
        .btn-play { background: var(--primary); color: #000; box-shadow: 0 5px 0 #b45309; }
        .btn-play:active { transform: translateY(5px); box-shadow: none; }
        .btn-cash { background: var(--green); color: white; box-shadow: 0 5px 0 #047857; display: none; }
        .btn-cash:active { transform: translateY(5px); box-shadow: none; }

        /* --- MINES & SLOTS (Common) --- */
        .center-stage { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        
        .mines-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; width: 100%; max-width: 340px; margin-bottom: 20px; }
        .tile { aspect-ratio: 1; background: #2d3748; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 20px; box-shadow: 0 3px 0 #1a202c; }
        .tile:active { transform: translateY(3px); box-shadow: none; }
        .tile.open { background: #1a202c; box-shadow: none; transform: translateY(3px); }
        .tile.gem { background: #065f46; border: 1px solid var(--green); }
        .tile.bomb { background: #7f1d1d; border: 1px solid var(--red); }

        .slot-machine { background: #4c1d95; padding: 15px; border-radius: 15px; border: 4px solid var(--primary); width: 100%; max-width: 320px; }
        .reels { display: flex; gap: 5px; background: #000; padding: 10px; border-radius: 10px; height: 120px; }
        .reel { flex: 1; display: flex; align-items: center; justify-content: center; font-size: 40px; background: #fff; border-radius: 5px; }

        /* --- BOTTOM NAV --- */
        .nav { height: 65px; min-height: 65px; background: var(--panel); border-top: 1px solid var(--border); display: flex; justify-content: space-around; align-items: center; z-index: 50; }
        .n-item { display: flex; flex-direction: column; align-items: center; color: #64748b; font-size: 10px; font-weight: 700; width: 60px; cursor: pointer; }
        .n-item.active { color: var(--primary); }
        .n-item i { font-size: 22px; margin-bottom: 4px; }
        .n-mid { width: 50px; height: 50px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; transform: translateY(-20px); border: 5px solid var(--bg); color: black; font-size: 24px; box-shadow: 0 5px 15px rgba(245, 158, 11, 0.4); }

        /* UTILS */
        .err { color: var(--red); font-size: 12px; margin-top: 10px; font-weight: bold; text-align: center; }
    </style>
</head>
<body>

    <div id="authScreen">
        <div class="auth-logo">JETWIN</div>
        <div class="auth-box">
            <input type="text" id="rName" class="inp" placeholder="Adƒ±nƒ±z">
            <input type="email" id="rEmail" class="inp" placeholder="Email">
            <input type="text" id="rCode" class="inp" placeholder="Promo Kod" style="text-align:center;">
            <button class="btn-auth" id="btnLogin" onclick="login()">Gƒ∞Rƒ∞≈û ET</button>
            <div id="authErr" class="err"></div>
            <span class="wa-help" onclick="goWa('Salam, Promo Kod lazƒ±mdƒ±r')"><i class="fa-brands fa-whatsapp"></i> Promo Kod Al</span>
        </div>
    </div>

    <div id="appScreen">
        <div class="header">
            <div class="h-logo">JETWIN</div>
            <div style="display:flex; align-items:center; gap:10px;">
                <div class="h-bal">$<span id="balVal">0.00</span></div>
                <i class="fa-solid fa-wallet" style="color:white; font-size:20px;" onclick="withdraw()"></i>
            </div>
        </div>

        <div id="mainView">
            
            <div id="v-lobby" class="view active">
                <div class="lobby-pad">
                    <div class="hero-banner" onclick="nav('game')">
                        <h2>JETX PRO</h2>
                        <p>Canlƒ± Oyna ‚Ä¢ Qazan</p>
                        <i class="fa-solid fa-rocket hero-icon"></i>
                    </div>
                    <div style="color:#888; font-weight:bold; margin-bottom:10px;">OYUNLAR</div>
                    <div class="game-grid">
                        <div class="g-card" onclick="nav('mines')">
                            <div class="g-icon">üí£</div><div class="g-name">MINES</div>
                        </div>
                        <div class="g-card" onclick="nav('slots')">
                            <div class="g-icon">üçí</div><div class="g-name">SLOTS</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="v-game" class="view">
                <div class="game-stage">
                    <canvas id="cvs"></canvas>
                    <div class="hud">
                        <div class="hud-m" id="jm">1.00x</div>
                        <div class="hud-s" id="js">G√ñZL∆èNƒ∞Lƒ∞R...</div>
                    </div>
                </div>
                <div class="controls">
                    <div class="bet-line">
                        <button class="b-btn" onclick="betAdj(-5)">-</button>
                        <input type="number" id="jetBet" class="b-inp" value="10" readonly>
                        <button class="b-btn" onclick="betAdj(5)">+</button>
                    </div>
                    <button class="act-btn btn-play" id="jpBtn" onclick="jetPlay()">M∆èRC ET</button>
                    <button class="act-btn btn-cash" id="jcBtn" onclick="jetCash()">PULU G√ñT√úR</button>
                </div>
            </div>

            <div id="v-mines" class="view">
                <div class="center-stage">
                    <h2 style="color:white; margin-bottom:10px;" id="mMsg">DA≈ûLARI SE√á</h2>
                    <div class="mines-grid" id="mGrid"></div>
                </div>
                <div class="controls">
                    <div class="bet-line">
                        <button class="b-btn" onclick="betAdjM(-5)">-</button>
                        <input type="number" id="mBet" class="b-inp" value="10" readonly>
                        <button class="b-btn" onclick="betAdjM(5)">+</button>
                    </div>
                    <button class="act-btn btn-play" id="mpBtn" onclick="minePlay()">OYNA</button>
                    <button class="act-btn btn-cash" id="mcBtn" onclick="mineCash()" style="background:var(--green);">G√ñT√úR</button>
                </div>
            </div>

            <div id="v-slots" class="view">
                <div class="center-stage">
                    <div class="slot-machine">
                        <div class="reels">
                            <div class="reel" id="r1">üçí</div>
                            <div class="reel" id="r2">üçã</div>
                            <div class="reel" id="r3">üçá</div>
                        </div>
                    </div>
                    <h2 style="color:var(--primary); margin-top:20px;" id="sMsg">SPIN!</h2>
                </div>
                <div class="controls">
                    <div class="bet-line">
                        <button class="b-btn" onclick="betAdjS(-5)">-</button>
                        <input type="number" id="sBet" class="b-inp" value="10" readonly>
                        <button class="b-btn" onclick="betAdjS(5)">+</button>
                    </div>
                    <button class="act-btn btn-play" id="spBtn" onclick="slotSpin()">FIRLAT</button>
                </div>
            </div>

        </div>

        <div class="nav">
            <div class="n-item active" id="nk-lobby" onclick="nav('lobby')"><i class="fa-solid fa-house"></i><span>Lobby</span></div>
            <div class="n-item" id="nk-mines" onclick="nav('mines')"><i class="fa-solid fa-bomb"></i><span>Mines</span></div>
            <div class="n-mid" onclick="nav('game')"><i class="fa-solid fa-rocket"></i></div>
            <div class="n-item" id="nk-slots" onclick="nav('slots')"><i class="fa-solid fa-lemon"></i><span>Slots</span></div>
            <div class="n-item" onclick="goWa('D…ôst…ôk lazƒ±mdƒ±r')"><i class="fa-brands fa-whatsapp"></i><span>D…ôst…ôk</span></div>
        </div>
    </div>

    <script>
        // CONFIG
        const API = "https://script.google.com/macros/s/AKfycbw5TG1rIhVZ_jqZjLy08KiTAC0YqrMc0QXD5Us22E4rpcb3hARRhW6LauxhZhwTpqmSCQ/exec";
        const WA = "994507516137";
        let user = { name:"", email:"", balance:0, deposit:0 };
        
        // INIT
        window.onload = () => {
            if(localStorage.getItem('jw_fix')) {
                user = JSON.parse(localStorage.getItem('jw_fix'));
                showApp();
            }
        };

        function goWa(txt) { window.location.href = `https://wa.me/${WA}?text=${encodeURIComponent(txt)}`; }
        function save() { localStorage.setItem('jw_fix', JSON.stringify(user)); document.getElementById('balVal').innerText = user.balance.toFixed(2); }

        // LOGIN
        async function login() {
            let n=document.getElementById('rName').value, e=document.getElementById('rEmail').value, c=document.getElementById('rCode').value;
            let btn=document.getElementById('btnLogin'), err=document.getElementById('authErr');
            
            if(n.length<3 || c.length<2) { err.innerText="M…ôlumatlarƒ± tam doldurun"; return; }
            
            btn.innerText = "YOXLANILIR...";
            try {
                let r = await fetch(`${API}?action=login&name=${encodeURIComponent(n)}&email=${encodeURIComponent(e)}&code=${encodeURIComponent(c)}`);
                let d = await r.json();
                if(d.result === 'success') {
                    user = { name:n, email:e, balance:parseFloat(d.balance), deposit:parseFloat(d.balance) };
                    save(); showApp();
                } else {
                    err.innerText = d.msg || "Kod yanlƒ±≈üdƒ±r"; btn.innerText = "Gƒ∞Rƒ∞≈û ET";
                }
            } catch(e) {
                err.innerText = "ƒ∞nternet x…ôtasƒ±! Yenid…ôn yoxlayƒ±n."; btn.innerText = "Gƒ∞Rƒ∞≈û ET";
            }
        }

        function showApp() {
            document.getElementById('authScreen').style.display='none';
            document.getElementById('appScreen').style.display='flex';
            document.getElementById('balVal').innerText = user.balance.toFixed(2);
            initMines(); // Pre-load
        }

        function withdraw() {
            if(user.balance > user.deposit) goWa(`ID: ${user.email}. Balans: $${user.balance}. √áƒ±xarƒ±≈ü!`);
            else alert(`Balans ilkin depozitd…ôn ($${user.deposit}) √ßox olmalƒ±dƒ±r.`);
        }

        function nav(page) {
            document.querySelectorAll('.view').forEach(e=>e.classList.remove('active'));
            document.querySelectorAll('.n-item').forEach(e=>e.classList.remove('active'));
            
            if(page==='lobby'){ document.getElementById('v-lobby').classList.add('active'); document.getElementById('nk-lobby').classList.add('active'); }
            if(page==='game'){ document.getElementById('v-game').classList.add('active'); initJetCanvas(); }
            if(page==='mines'){ document.getElementById('v-mines').classList.add('active'); document.getElementById('nk-mines').classList.add('active'); }
            if(page==='slots'){ document.getElementById('v-slots').classList.add('active'); document.getElementById('nk-slots').classList.add('active'); }
        }

        // --- JETX ---
        let jPlay=false, jMult=1.0, jAnim, jStart;
        function betAdj(v){ let el=document.getElementById('jetBet'); let val=parseInt(el.value)+v; if(val<1)val=1; el.value=val; }
        
        function initJetCanvas() {
            const c = document.getElementById('cvs');
            c.width = c.parentElement.offsetWidth;
            c.height = c.parentElement.offsetHeight;
            const ctx = c.getContext('2d');
            ctx.fillStyle="#0b0f19"; ctx.fillRect(0,0,c.width,c.height);
        }

        function jetPlay() {
            let bet = parseInt(document.getElementById('jetBet').value);
            if(user.balance<bet){ goWa('Depozit'); return; }
            user.balance-=bet; save();
            
            jPlay=true; jMult=1.0; jStart=Date.now();
            document.getElementById('jpBtn').style.display='none';
            document.getElementById('jcBtn').style.display='block';
            document.getElementById('jm').style.color="white";
            document.getElementById('js').innerText="U√áUR...";
            
            // Rigged: 60% low crash
            let crash = Math.random()<0.6 ? 1.0+Math.random()*0.5 : 1.5+Math.random()*5;
            
            function loop() {
                if(!jPlay) return;
                let t = (Date.now()-jStart)/1000;
                jMult = 1.0 + (t*t*0.1);
                document.getElementById('jm').innerText = jMult.toFixed(2)+"x";
                
                // Draw
                const c = document.getElementById('cvs');
                const ctx = c.getContext('2d');
                ctx.clearRect(0,0,c.width,c.height);
                // Stars
                ctx.fillStyle="rgba(255,255,255,0.2)";
                for(let i=0;i<20;i++) ctx.fillRect(Math.random()*c.width,Math.random()*c.height,2,2);
                
                let x = Math.min(c.width-50, t*100);
                let y = c.height - Math.min(c.height-50, (jMult-1)*150);
                
                ctx.beginPath(); ctx.lineWidth=4; ctx.strokeStyle="#f59e0b";
                ctx.moveTo(0,c.height); ctx.quadraticCurveTo(x/2,c.height,x,y); ctx.stroke();
                
                ctx.font="30px Arial"; ctx.fillText("üöÄ", x-20, y);

                if(jMult>=crash) {
                    jPlay=false;
                    document.getElementById('jm').classList.add('crashed');
                    document.getElementById('jm').style.color="red";
                    document.getElementById('js').innerText="PARTLADI!";
                    setTimeout(jetReset,2000);
                } else {
                    jAnim = requestAnimationFrame(loop);
                }
            }
            loop();
        }

        function jetCash() {
            if(!jPlay)return;
            jPlay=false; cancelAnimationFrame(jAnim);
            let win = parseInt(document.getElementById('jetBet').value)*jMult;
            user.balance+=win; save();
            document.getElementById('js').innerText=`WIN: $${win.toFixed(2)}`;
            document.getElementById('jm').style.color="#10b981";
            fetch(`${API}?action=win&name=${user.name}&email=${user.email}&amount=${win.toFixed(2)}`, {mode:'no-cors'});
            setTimeout(jetReset,2000);
        }

        function jetReset() {
            document.getElementById('jpBtn').style.display='block';
            document.getElementById('jcBtn').style.display='none';
            document.getElementById('jm').innerText="1.00x";
            document.getElementById('js').innerText="G√ñZL∆èNƒ∞Lƒ∞R...";
            initJetCanvas();
        }

        // --- MINES ---
        let mPlay=false, mMult=1.0, mBet=10, mStep=0;
        function betAdjM(v){ let el=document.getElementById('mBet'); let val=parseInt(el.value)+v; if(val<1)val=1; el.value=val; }
        
        function initMines() {
            const g = document.getElementById('mGrid'); g.innerHTML="";
            for(let i=0; i<25; i++) {
                let d = document.createElement('div');
                d.className='tile'; d.id='mt'+i; d.onclick=()=>mineHit(i);
                g.appendChild(d);
            }
        }

        function minePlay() {
            mBet = parseInt(document.getElementById('mBet').value);
            if(user.balance<mBet){ goWa('Depozit'); return; }
            user.balance-=mBet; save();
            mPlay=true; mMult=1.0; mStep=0;
            document.getElementById('mpBtn').style.display='none';
            document.getElementById('mcBtn').style.display='block';
            document.getElementById('mcBtn').innerText="G√ñT√úR";
            document.getElementById('mMsg').innerText="DA≈ûLARI SE√á...";
            initMines();
        }

        function mineHit(i) {
            if(!mPlay) return;
            let t = document.getElementById('mt'+i);
            if(t.classList.contains('open')) return;
            
            // Rigged: 1st safe, then risk
            let bomb = (mStep<1) ? (Math.random()<0.05) : (Math.random()<0.5);
            
            t.classList.add('open');
            if(bomb) {
                t.classList.add('bomb'); t.innerHTML="üí£";
                mPlay=false; document.getElementById('mMsg').innerText="PARTLADI!";
                setTimeout(mineReset,2000);
            } else {
                t.classList.add('gem'); t.innerHTML="üíé";
                mStep++; mMult*=1.2;
                document.getElementById('mcBtn').innerText=`G√ñT√úR ($${(mBet*mMult).toFixed(2)})`;
            }
        }

        function mineCash() {
            if(!mPlay)return;
            let win=mBet*mMult; user.balance+=win; save();
            mPlay=false; document.getElementById('mMsg').innerText=`QAZANDIN: $${win.toFixed(2)}`;
            fetch(`${API}?action=win&name=${user.name}&email=${user.email}&amount=${win.toFixed(2)}`, {mode:'no-cors'});
            mineReset();
        }
        function mineReset(){ 
            document.getElementById('mpBtn').style.display='block';
            document.getElementById('mcBtn').style.display='none';
        }

        // --- SLOTS ---
        function betAdjS(v){ let el=document.getElementById('sBet'); let val=parseInt(el.value)+v; if(val<1)val=1; el.value=val; }
        const syms=["üçí","üçã","üçá","7Ô∏è‚É£"];
        
        function slotSpin() {
            let bet = parseInt(document.getElementById('sBet').value);
            if(user.balance<bet){ goWa('Depozit'); return; }
            user.balance-=bet; save();
            
            let btn = document.getElementById('spBtn'); btn.disabled=true;
            document.getElementById('sMsg').innerText=".......";
            
            // Anim
            [1,2,3].forEach(i=>document.getElementById('r'+i).innerText="‚ùì");
            
            setTimeout(()=>{
                // Rigged: Mostly lose
                let res = (Math.random()<0.2) ? [0,0,0] : [0,1,2]; 
                
                [1,2,3].forEach((i,x)=>document.getElementById('r'+i).innerText=syms[res[x]]);
                
                btn.disabled=false;
                if(res[0]==res[1] && res[1]==res[2]) {
                    let win=bet*3; user.balance+=win; save();
                    document.getElementById('sMsg').innerText=`WIN: $${win}`;
                } else {
                    document.getElementById('sMsg').innerText="UDUZDUNUZ";
                }
            },1000);
        }

        // Handle Resize
        window.onresize = ()=>{ if(document.getElementById('v-game').classList.contains('active')) initJetCanvas(); };
    </script>
</body>
</html>
