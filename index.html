<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0b0f19">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>JETWIN | PRO</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&family=Rajdhani:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- CORE STYLES --- */
        :root {
            --bg: #0b0f19; --panel: #151a25; --primary: #007aff; --accent: #00d4ff; 
            --gold: #ffcc00; --green: #34c759; --red: #ff3b30; --text: #ffffff; --text-mute: #8e8e93;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; outline: none; }
        body {
            margin: 0; padding: 0; background-color: var(--bg); color: var(--text);
            font-family: 'Inter', sans-serif; height: 100vh; height: 100dvh;
            overflow: hidden; display: flex; flex-direction: column;
        }

        /* --- 1. AUTH --- */
        #authScreen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2000;
            background: radial-gradient(circle at top right, #1a2133 0%, #000 100%);
            display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 30px; text-align: center;
        }
        .auth-logo { font-family: 'Rajdhani'; font-size: 42px; font-weight: 900; letter-spacing: -1px; margin-bottom: 10px; }
        .auth-logo span { color: var(--primary); }
        .auth-form { width: 100%; max-width: 350px; display: flex; flex-direction: column; gap: 15px; }
        .custom-inp {
            width: 100%; padding: 16px; background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; color: white; font-size: 16px;
        }
        .btn-main {
            width: 100%; padding: 18px; background: linear-gradient(135deg, var(--primary), #0055ff);
            border: none; border-radius: 12px; font-size: 16px; font-weight: 800; color: white; cursor: pointer;
        }

        /* --- 2. MAIN APP --- */
        #appScreen { display: none; flex-direction: column; height: 100%; width: 100%; }

        .app-header {
            height: 60px; display: flex; justify-content: space-between; align-items: center;
            padding: 0 15px; background: rgba(21, 26, 37, 0.95); border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .user-block { display: flex; align-items: center; gap: 10px; }
        .avatar { width: 32px; height: 32px; background: #2c3e50; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--accent); font-weight: bold; }
        .u-info { display: flex; flex-direction: column; }
        .u-bal { font-size: 11px; color: var(--green); font-weight: 600; }
        
        /* NEW HISTORY BAR */
        .history-bar {
            display: flex; gap: 6px; padding: 6px 10px; background: #0f121b;
            overflow-x: auto; height: 40px; align-items: center; border-bottom: 1px solid #222;
        }
        .history-bar::-webkit-scrollbar { display: none; }
        .hist-item {
            padding: 4px 8px; border-radius: 6px; font-size: 11px; font-weight: 800; font-family: 'Rajdhani';
            min-width: 45px; text-align: center; flex-shrink: 0;
        }
        .h-win { background: rgba(52, 199, 89, 0.15); color: #34c759; border: 1px solid rgba(52, 199, 89, 0.3); }
        .h-lose { background: rgba(255, 59, 48, 0.15); color: #ff3b30; border: 1px solid rgba(255, 59, 48, 0.3); }
        .h-big { background: rgba(255, 204, 0, 0.15); color: var(--gold); border: 1px solid var(--gold); box-shadow: 0 0 5px rgba(255,204,0,0.2); }

        /* GAME STAGE */
        .stage { flex: 1; position: relative; overflow: hidden; background: radial-gradient(circle at 50% 100%, #1a2133 0%, #0b0f19 70%); }
        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        
        .center-hud {
            position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%);
            text-align: center; z-index: 10; pointer-events: none;
        }
        .multiplier { font-family: 'Rajdhani'; font-size: 72px; font-weight: 800; color: white; text-shadow: 0 0 30px rgba(0, 122, 255, 0.6); transition: 0.1s; }
        .status-txt { font-size: 12px; color: var(--text-mute); letter-spacing: 2px; font-weight: 600; margin-top: 5px; }

        /* CONTROLS */
        .controls {
            background: var(--panel); padding: 15px; border-radius: 20px 20px 0 0;
            border-top: 1px solid rgba(255,255,255,0.05); z-index: 50; box-shadow: 0 -10px 40px rgba(0,0,0,0.6);
        }
        
        .input-row { display: flex; gap: 10px; margin-bottom: 15px; }
        
        /* Bet Input Section */
        .bet-section { flex: 1; display: flex; flex-direction: column; gap: 5px; }
        .label-sm { font-size: 10px; color: #666; text-transform: uppercase; font-weight: bold; margin-left: 2px; }
        
        .bet-input-wrap {
            display: flex; background: #0b0f19; border: 1px solid #333; border-radius: 10px; padding: 2px;
        }
        .bet-mod-btn {
            width: 40px; background: transparent; border: none; color: #666; font-size: 18px; font-weight: bold;
        }
        .bet-val {
            flex: 1; background: transparent; border: none; color: white; font-size: 18px; font-weight: bold; text-align: center; padding: 10px 0;
        }
        
        /* Auto Cashout Section */
        .auto-section { width: 100px; display: flex; flex-direction: column; gap: 5px; }
        .auto-input-wrap {
            display: flex; align-items: center; background: #0b0f19; border: 1px solid #333; border-radius: 10px; padding: 0 10px; height: 100%;
        }
        .auto-lbl { color: #555; font-size: 12px; margin-right: 5px; }
        .sw-toggle { position: relative; width: 30px; height: 16px; background: #333; border-radius: 20px; transition: 0.3s; }
        .sw-toggle.active { background: var(--green); }
        .sw-circle { position: absolute; left: 2px; top: 2px; width: 12px; height: 12px; background: white; border-radius: 50%; transition: 0.3s; }
        .sw-toggle.active .sw-circle { left: 16px; }

        .action-btn {
            width: 100%; height: 56px; border-radius: 12px; border: none;
            font-size: 18px; font-weight: 800; text-transform: uppercase;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3); transition: 0.1s; cursor: pointer;
        }
        .btn-bet { background: linear-gradient(135deg, var(--primary), #0066ff); color: white; }
        .btn-cash { background: linear-gradient(135deg, var(--gold), #ff9500); color: black; display: none; box-shadow: 0 0 20px rgba(255, 204, 0, 0.4); }

        /* BOTTOM NAV */
        .bottom-nav {
            height: 70px; background: #0b0f19; border-top: 1px solid #222;
            display: flex; justify-content: space-around; align-items: center; padding-bottom: 10px;
        }
        .nav-item { color: #555; font-size: 10px; display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .nav-item i { font-size: 20px; }
        .nav-item.active { color: var(--primary); }

        /* ANIMATIONS */
        .crashed { color: var(--red) !important; animation: shake 0.4s; text-shadow: 0 0 30px var(--red) !important; }
        .won { color: var(--green) !important; text-shadow: 0 0 40px var(--green) !important; transform: scale(1.1); }
        @keyframes shake { 0%, 100% {transform: translate(-50%,-50%);} 25% {transform: translate(-52%, -48%);} 75% {transform: translate(-48%, -52%);} }
    </style>
</head>
<body>

    <div id="authScreen">
        <div class="auth-logo">JETWIN <span>PRO</span></div>
        <p style="color:#888; margin-bottom:30px; font-size:14px;">Next Gen Mobile Gaming</p>
        <div class="auth-form">
            <input type="text" id="regName" class="custom-inp" placeholder="Adƒ±nƒ±z">
            <input type="text" id="regSurname" class="custom-inp" placeholder="Soyadƒ±nƒ±z">
            <button class="btn-main" onclick="registerUser()">DAXƒ∞L OL</button>
        </div>
    </div>

    <div id="appScreen">
        <div class="app-header">
            <div class="user-block">
                <div class="avatar" id="uInitials">U</div>
                <div class="u-info">
                    <span style="font-size:13px; font-weight:700;" id="uName">User</span>
                    <span class="u-bal">$<span id="bal">0.00</span></span>
                </div>
            </div>
            <div style="font-size:10px; color:#666;"><span style="color:var(--green)">‚óè</span> Online</div>
        </div>

        <div class="history-bar" id="historyBar">
            <div class="hist-item" style="color:#555; font-weight:normal;">History loading...</div>
        </div>

        <div class="stage" id="stage">
            <canvas id="stars"></canvas>
            <canvas id="game"></canvas>
            <canvas id="fx"></canvas> <div class="center-hud">
                <div class="multiplier" id="multi">1.00x</div>
                <div class="status-txt" id="status">TAP TO BET</div>
            </div>
        </div>

        <div class="controls">
            <div class="input-row">
                <div class="bet-section">
                    <div class="label-sm">M…ôbl…ôƒü</div>
                    <div class="bet-input-wrap">
                        <button class="bet-mod-btn" onclick="adjBet(-5)">-</button>
                        <input type="number" id="betVal" class="bet-val" value="10">
                        <button class="bet-mod-btn" onclick="adjBet(5)">+</button>
                    </div>
                </div>

                <div class="auto-section">
                    <div class="label-sm">Avto-Satƒ±≈ü</div>
                    <div class="auto-input-wrap" onclick="toggleAuto()">
                        <span class="auto-lbl">x</span>
                        <input type="number" id="autoVal" class="bet-val" value="2.00" style="text-align:left; padding-left:0;" onclick="event.stopPropagation()">
                        <div class="sw-toggle" id="autoSw"><div class="sw-circle"></div></div>
                    </div>
                </div>
            </div>
            
            <button class="action-btn btn-bet" id="btnBet" onclick="play()">M∆èRC ET</button>
            <button class="action-btn btn-cash" id="btnCash" onclick="cashOut()">PULU G√ñT√úR</button>
        </div>

        <div class="bottom-nav">
            <div class="nav-item active"><i class="fa-solid fa-gamepad"></i>Oyun</div>
            <div class="nav-item" onclick="openPromo()"><i class="fa-solid fa-gift"></i>Promo</div>
            <div class="nav-item" onclick="wa('deposit')"><i class="fa-solid fa-wallet"></i>Depozit</div>
            <div class="nav-item" onclick="wa('withdraw')"><i class="fa-solid fa-money-bill-transfer"></i>√áƒ±xarƒ±≈ü</div>
        </div>
    </div>

    <script>
        // --- CONFIG & STATE ---
        const API_URL = "https://script.google.com/macros/s/AKfycbzK7CLi85c5GD8juIME-2RdQULXFCvS2zO3So7aaYV9apcTahXkJYWe0qcyJe3YQHDKhA/exec";
        const ADMIN_WA = "994507516137";
        
        let balance = 0.00;
        let totalDeposited = 0.00;
        let isPlaying = false;
        let multi = 1.00;
        let crashPoint = 0;
        let startTime, animFrame;
        
        // Auto Cashout State
        let autoEnabled = false;

        // History
        let history = [1.20, 5.43, 1.05, 2.30, 1.88, 11.50]; // Fake start history

        // --- AUDIO ENGINE (SINTEZATOR) ---
        // Bu sistem brauzerin √∂z s…ôs m√ºh…ôrrikini i≈ül…ôdir, fayl lazƒ±m deyil.
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const ctxAudio = new AudioContext();
        
        function playTone(type) {
            if(ctxAudio.state === 'suspended') ctxAudio.resume();
            const osc = ctxAudio.createOscillator();
            const gain = ctxAudio.createGain();
            osc.connect(gain);
            gain.connect(ctxAudio.destination);

            const now = ctxAudio.currentTime;

            if (type === 'click') {
                osc.frequency.setValueAtTime(800, now);
                gain.gain.setValueAtTime(0.1, now);
                osc.type = 'sine';
                osc.start(now);
                osc.stop(now + 0.05);
            }
            else if (type === 'win') {
                osc.frequency.setValueAtTime(600, now);
                osc.frequency.exponentialRampToValueAtTime(1200, now + 0.1);
                gain.gain.setValueAtTime(0.3, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);
                osc.type = 'triangle';
                osc.start(now);
                osc.stop(now + 0.4);
            }
            else if (type === 'crash') {
                osc.frequency.setValueAtTime(100, now);
                osc.frequency.exponentialRampToValueAtTime(30, now + 0.3);
                gain.gain.setValueAtTime(0.5, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
                osc.type = 'sawtooth';
                osc.start(now);
                osc.stop(now + 0.3);
            }
        }

        // --- INIT ---
        if(localStorage.getItem('jw_user_data')) {
            const user = JSON.parse(localStorage.getItem('jw_user_data'));
            loadApp(user.name, user.surname);
        }

        function registerUser() {
            playTone('click');
            let name = document.getElementById('regName').value.trim();
            let surname = document.getElementById('regSurname').value.trim();
            if(!name || !surname) return alert("Ad v…ô Soyad daxil edin");

            localStorage.setItem('jw_user_data', JSON.stringify({name, surname}));
            loadApp(name, surname);
        }

        function loadApp(name, surname) {
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('appScreen').style.display = 'flex';
            document.getElementById('uName').innerText = name;
            document.getElementById('uInitials').innerText = name[0] + surname[0];
            
            renderHistory();
            initGraphics();
            runGhostMode();
        }

        // --- GAME LOGIC ---
        function toggleAuto() {
            autoEnabled = !autoEnabled;
            document.getElementById('autoSw').classList.toggle('active', autoEnabled);
            playTone('click');
        }

        function play() {
            playTone('click');
            let bet = parseInt(document.getElementById('betVal').value);
            if(balance < bet) return alert("Balans yoxdur!");

            balance -= bet; updateUI();
            isPlaying = true;
            multi = 1.00;
            
            // UI Reset
            document.getElementById('btnBet').style.display = 'none';
            document.getElementById('btnCash').style.display = 'block';
            document.getElementById('multi').classList.remove('crashed', 'won');
            document.getElementById('multi').style.color = 'white';
            document.getElementById('status').innerText = "FLYING...";

            // ALGORITHM
            let r = Math.random();
            if(totalDeposited > 0) {
                 if(bet > 20) crashPoint = 1.00 + Math.random()*0.2; 
                 else crashPoint = r < 0.4 ? 1.00 + Math.random()*0.3 : 2.0 + Math.random()*5;
            } else {
                 crashPoint = r < 0.1 ? 1.10 : 1.50 + Math.random() * 4.00; 
            }

            startTime = Date.now();
            loop();
        }

        function loop() {
            if(!isPlaying) return;
            let t = (Date.now() - startTime) / 1000;
            multi = 1.00 + (t * t * 0.08);

            // AUTO CASHOUT CHECK
            if(autoEnabled) {
                let target = parseFloat(document.getElementById('autoVal').value);
                if(multi >= target) {
                    cashOut();
                    return;
                }
            }

            if(multi >= crashPoint) { crash(); return; }

            document.getElementById('multi').innerText = multi.toFixed(2) + "x";
            draw(t);
            animFrame = requestAnimationFrame(loop);
        }

        function cashOut() {
            if(!isPlaying) return;
            isPlaying = false; 
            cancelAnimationFrame(animFrame);
            playTone('win');

            let bet = parseInt(document.getElementById('betVal').value);
            let win = bet * multi;
            balance += win; updateUI();

            document.getElementById('multi').classList.add('won');
            document.getElementById('status').innerText = `WON $${win.toFixed(0)}`;
            
            // Show particle confetti
            spawnParticles(cvs.width/2, cvs.height/2, 'gold');
            
            setTimeout(reset, 2500);
        }

        function crash() {
            isPlaying = false; 
            cancelAnimationFrame(animFrame);
            playTone('crash');
            
            // Add to History Only on Crash
            addToHistory(multi);

            document.getElementById('multi').innerText = multi.toFixed(2) + "x"; // Show exact crash point
            document.getElementById('multi').classList.add('crashed');
            document.getElementById('status').innerText = "CRASHED";
            
            if(navigator.vibrate) navigator.vibrate(200);
            
            // Explosion Effect
            spawnParticles(lastX, lastY, 'red');

            setTimeout(reset, 2500);
        }

        function reset() {
            document.getElementById('btnBet').style.display = 'block';
            document.getElementById('btnCash').style.display = 'none';
            document.getElementById('multi').innerText = "1.00x";
            document.getElementById('multi').style.color = "white";
            document.getElementById('multi').classList.remove('crashed', 'won');
            document.getElementById('status').innerText = "TAP TO BET";
            runGhostMode();
        }

        // --- HISTORY ---
        function addToHistory(val) {
            history.unshift(val);
            if(history.length > 20) history.pop();
            renderHistory();
        }
        function renderHistory() {
            let html = "";
            history.forEach(h => {
                let cls = h < 1.2 ? 'h-lose' : (h > 10 ? 'h-big' : 'h-win');
                html += `<div class="hist-item ${cls}">${h.toFixed(2)}x</div>`;
            });
            document.getElementById('historyBar').innerHTML = html;
        }

        // --- GRAPHICS & PARTICLES ---
        const cvs = document.getElementById('game');
        const ctx = cvs.getContext('2d');
        const cvsFx = document.getElementById('fx');
        const ctxFx = cvsFx.getContext('2d');
        let w, h;
        let lastX = 0, lastY = 0;
        let particles = [];

        function initGraphics() {
            w = cvs.width = cvsFx.width = document.getElementById('stage').offsetWidth;
            h = cvs.height = cvsFx.height = document.getElementById('stage').offsetHeight;
            drawStars();
        }
        window.addEventListener('resize', initGraphics);

        function draw(t) {
            ctx.clearRect(0,0,w,h);
            ctxFx.clearRect(0,0,w,h);
            
            let x = Math.min(w - 50, t * 100);
            let y = h - Math.min(h - 50, (multi - 1) * 150);
            lastX = x; lastY = y;

            // Trail
            ctx.beginPath(); ctx.lineWidth = 4; ctx.strokeStyle = "#007aff";
            ctx.moveTo(0, h); ctx.quadraticCurveTo(x/2, h, x, y); ctx.stroke();
            
            // Rocket
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(-45 * Math.PI / 180);
            ctx.font = "30px Arial";
            ctx.fillText("üöÄ", -15, 10);
            ctx.restore();

            updateParticles();
        }

        function spawnParticles(x, y, color) {
            for(let i=0; i<30; i++) {
                particles.push({
                    x: x, y: y,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10,
                    life: 1.0,
                    color: color === 'red' ? '#ff3b30' : '#ffcc00'
                });
            }
            if(!isPlaying) requestAnimationFrame(postGameAnim);
        }

        function updateParticles() {
            for(let i=particles.length-1; i>=0; i--) {
                let p = particles[i];
                p.x += p.vx; p.y += p.vy;
                p.life -= 0.02;
                ctxFx.fillStyle = p.color;
                ctxFx.globalAlpha = p.life;
                ctxFx.beginPath(); ctxFx.arc(p.x, p.y, 3, 0, Math.PI*2); ctxFx.fill();
                if(p.life <= 0) particles.splice(i, 1);
            }
            ctxFx.globalAlpha = 1.0;
        }

        function postGameAnim() {
            if(particles.length > 0) {
                ctxFx.clearRect(0,0,w,h);
                updateParticles();
                requestAnimationFrame(postGameAnim);
            }
        }

        function runGhostMode() {
            if(isPlaying) return;
            multi = 1.00;
            let target = 1.5 + Math.random()*5;
            let start = Date.now();
            function g() {
                if(isPlaying) return;
                let t = (Date.now() - start)/1000;
                multi = 1.00 + (t*t*0.08);
                if(multi>=target) { setTimeout(runGhostMode,1000); return; }
                document.getElementById('multi').innerText = multi.toFixed(2) + "x";
                draw(t);
                requestAnimationFrame(g);
            }
            g();
        }

        // --- UTILS ---
        function adjBet(v) { 
            let el = document.getElementById('betVal'); 
            let val = parseInt(el.value) + v;
            if(val < 1) val = 1; el.value = val;
            playTone('click');
        }
        function updateUI() { document.getElementById('bal').innerText = balance.toFixed(2); }
        function drawStars() {
            const sCtx = document.getElementById('stars').getContext('2d');
            sCtx.clearRect(0,0,w,h); sCtx.fillStyle = "rgba(255,255,255,0.3)";
            for(let i=0; i<60; i++) sCtx.beginPath(), sCtx.arc(Math.random()*w, Math.random()*h, Math.random()*2, 0, 6.28), sCtx.fill();
        }
        async function openPromo() {
            let code = prompt("Promo Code:");
            if(code === "JETWIN2024") { balance += 50; updateUI(); alert("Success +$50"); }
        }
        function wa(type) { window.open(`https://wa.me/${ADMIN_WA}?text=${type}`, '_blank'); }

    </script>
</body>
</html>
