<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0b0f19">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>JETWIN | ELITE</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;900&family=Rajdhani:wght@700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- RESET & CORE --- */
        :root {
            --bg: #0b0f19;
            --panel: #161b2c;
            --primary: #f59e0b; 
            --primary-g: linear-gradient(135deg, #f59e0b, #d97706);
            --green: #10b981;
            --red: #ef4444;
            --text: #ffffff;
            --text-mute: #94a3b8;
            --glass: rgba(22, 27, 44, 0.95);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; outline: none; }
        
        body {
            margin: 0; padding: 0;
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Inter', sans-serif;
            height: 100vh; height: 100dvh; /* Mobile Fix */
            display: flex; flex-direction: column;
            overflow: hidden;
        }

        /* --- UI COMPONENTS --- */
        button { cursor: pointer; font-family: 'Inter', sans-serif; }
        button:active { transform: scale(0.96); transition: 0.1s; }

        /* HEADER */
        .app-header {
            height: 60px; padding: 0 15px; display: flex; justify-content: space-between; align-items: center;
            background: var(--glass); border-bottom: 1px solid rgba(255,255,255,0.05);
            position: absolute; top: 0; width: 100%; z-index: 100;
        }
        .logo { font-family: 'Rajdhani'; font-weight: 900; font-size: 26px; color: var(--primary); letter-spacing: -1px; }
        .bal-display {
            background: rgba(0,0,0,0.3); padding: 5px 12px; border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.1); font-weight: 700; font-size: 14px;
            display: flex; align-items: center; gap: 5px;
        }
        .bal-val { color: var(--green); font-family: 'Rajdhani'; font-size: 16px; }

        .btn-withdraw {
            width: 34px; height: 34px; border-radius: 8px; border: none;
            background: var(--green); color: white; margin-left: 8px;
            display: flex; align-items: center; justify-content: center;
        }

        /* --- AUTH SCREEN --- */
        #authScreen {
            position: fixed; inset: 0; z-index: 9999;
            background: url('https://img.freepik.com/free-vector/dark-gradient-background-with-copy-space_53876-99548.jpg') center/cover;
            display: flex; flex-direction: column; justify-content: flex-end;
            padding-bottom: 40px;
        }
        .auth-box {
            background: linear-gradient(to top, #0b0f19 20%, transparent);
            padding: 30px; text-align: center;
        }
        .auth-inp {
            width: 100%; padding: 16px; margin-bottom: 10px; border-radius: 12px;
            background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.1);
            color: white; font-size: 16px; backdrop-filter: blur(5px);
        }
        .auth-inp:focus { border-color: var(--primary); }
        .btn-login {
            width: 100%; padding: 18px; border-radius: 12px; border: none;
            background: var(--primary-g); color: white; font-weight: 800; font-size: 18px;
            text-transform: uppercase; box-shadow: 0 5px 20px rgba(245, 158, 11, 0.3);
        }
        .wa-link { color: var(--green); margin-top: 15px; display: block; font-size: 14px; font-weight: 600; text-decoration: none; }

        /* --- MAIN CONTENT AREA --- */
        #mainContainer {
            flex: 1; margin-top: 60px; margin-bottom: 70px;
            overflow-y: auto; overflow-x: hidden; position: relative;
        }
        
        /* VIEWS */
        .view-section { display: none; height: 100%; }
        .view-section.active { display: block; }

        /* --- LOBBY --- */
        .lobby-hero {
            margin: 15px; padding: 25px; border-radius: 20px;
            background: linear-gradient(135deg, #ea580c, #d97706);
            color: white; position: relative; overflow: hidden;
            box-shadow: 0 10px 30px rgba(234, 88, 12, 0.3);
        }
        .lobby-hero h2 { margin: 0; font-family: 'Rajdhani'; font-size: 32px; font-weight: 900; }
        .lobby-hero i { position: absolute; right: 20px; top: 50%; transform: translateY(-50%); font-size: 50px; opacity: 0.3; }
        
        .game-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 0 15px 20px; }
        .game-item {
            background: var(--panel); border: 1px solid rgba(255,255,255,0.05);
            border-radius: 16px; padding: 20px; text-align: center;
            display: flex; flex-direction: column; align-items: center; gap: 10px;
        }
        .g-img { font-size: 36px; margin-bottom: 5px; }

        /* --- JETX GAME (Fixed Z-Index) --- */
        #gameView { position: relative; width: 100%; height: 100%; background: #0b0f19; overflow: hidden; }
        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
        
        .jet-hud {
            position: absolute; top: 30%; left: 50%; transform: translate(-50%, -50%);
            text-align: center; z-index: 2; pointer-events: none;
        }
        .jet-multi { font-family: 'Rajdhani'; font-size: 70px; font-weight: 900; color: white; text-shadow: 0 0 20px rgba(0,0,0,0.8); }
        .jet-status { font-size: 14px; color: var(--text-mute); background: rgba(0,0,0,0.6); padding: 4px 12px; border-radius: 20px; }

        .game-controls {
            position: absolute; bottom: 0; width: 100%; padding: 20px;
            background: var(--panel); border-top-left-radius: 24px; border-top-right-radius: 24px;
            z-index: 10; /* Important: Above Canvas */
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        .bet-input-row { display: flex; gap: 10px; margin-bottom: 15px; }
        .bet-inp { flex: 1; background: #0b0f19; border: 1px solid #333; color: white; text-align: center; font-size: 20px; font-weight: bold; border-radius: 10px; padding: 12px; }
        .bet-mod { width: 45px; background: rgba(255,255,255,0.1); border: none; color: white; border-radius: 10px; font-size: 18px; }

        .action-btn { width: 100%; padding: 16px; border-radius: 12px; border: none; font-size: 18px; font-weight: 900; text-transform: uppercase; }
        .btn-play { background: var(--primary-g); color: white; box-shadow: 0 5px 15px rgba(245, 158, 11, 0.2); }
        .btn-cash { background: var(--green); color: white; display: none; box-shadow: 0 5px 15px rgba(16, 185, 129, 0.2); }

        /* --- MINES GAME --- */
        .mines-wrap { height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; }
        .mines-grid-box { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; width: 100%; max-width: 350px; margin-bottom: 20px; }
        .mine-cell { aspect-ratio: 1; background: #2d3748; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 22px; transition: 0.2s; box-shadow: inset 0 -3px 0 rgba(0,0,0,0.3); }
        .mine-cell.safe { background: #065f46; box-shadow: none; }
        .mine-cell.boom { background: #7f1d1d; box-shadow: none; }

        /* --- SLOTS GAME --- */
        .slots-wrap { height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; background: #1a0b2e; }
        .slot-machine { background: #4c1d95; padding: 20px; border-radius: 20px; border: 4px solid #f59e0b; width: 90%; max-width: 350px; }
        .reels { display: flex; gap: 5px; background: #000; padding: 10px; border-radius: 10px; height: 140px; overflow: hidden; position: relative; }
        .reel-col { flex: 1; display: flex; flex-direction: column; align-items: center; }
        .sym { height: 120px; display: flex; align-items: center; justify-content: center; font-size: 50px; }

        /* --- BONUS WHEEL --- */
        .bonus-wrap { text-align: center; padding: 30px; }
        .wheel-container { position: relative; width: 260px; height: 260px; margin: 0 auto 30px; }
        .wheel-circle { width: 100%; height: 100%; border-radius: 50%; border: 6px solid #333; background: conic-gradient(#ef4444 0deg 60deg, #3b82f6 60deg 120deg, #10b981 120deg 180deg, #f59e0b 180deg 240deg, #8b5cf6 240deg 300deg, #ec4899 300deg 360deg); transition: 4s ease-out; }
        .wheel-pointer { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); width: 30px; height: 30px; background: white; clip-path: polygon(50% 100%, 0 0, 100% 0); z-index: 5; }

        /* --- BOTTOM NAV --- */
        .btm-nav {
            height: 70px; background: var(--glass); border-top: 1px solid rgba(255,255,255,0.05);
            position: fixed; bottom: 0; width: 100%; z-index: 100;
            display: flex; justify-content: space-around; align-items: center;
        }
        .nav-btn { display: flex; flex-direction: column; align-items: center; color: var(--text-mute); font-size: 10px; font-weight: 600; opacity: 0.6; }
        .nav-btn.active { color: var(--primary); opacity: 1; }
        .nav-btn i { font-size: 20px; margin-bottom: 4px; }
        .nav-mid {
            width: 50px; height: 50px; background: var(--primary-g); border-radius: 50%;
            display: flex; align-items: center; justify-content: center; color: white;
            transform: translateY(-20px); border: 4px solid var(--bg); box-shadow: 0 5px 15px rgba(245, 158, 11, 0.4);
        }

        /* --- UTILS --- */
        .hidden { display: none !important; }
        .err-msg { color: var(--red); margin-top: 10px; font-size: 13px; font-weight: bold; }
        .win-anim { animation: pulse 0.5s infinite; color: var(--green) !important; }
        @keyframes pulse { 0%{transform:scale(1);} 50%{transform:scale(1.1);} 100%{transform:scale(1);} }

    </style>
</head>
<body>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbw5TG1rIhVZ_jqZjLy08KiTAC0YqrMc0QXD5Us22E4rpcb3hARRhW6LauxhZhwTpqmSCQ/exec";
        const WA_NUM = "994507516137";
        function openWA(msg) { window.location.href = `https://wa.me/${WA_NUM}?text=${encodeURIComponent(msg)}`; }
    </script>

    <div id="authScreen">
        <div class="auth-box">
            <h1 class="logo" style="font-size: 40px; margin-bottom: 5px;">JETWIN</h1>
            <p style="color:#aaa; font-size:12px; letter-spacing:3px; margin-bottom:30px;">ULTIMATE CASINO</p>
            
            <input type="text" id="rName" class="auth-inp" placeholder="Adƒ±nƒ±z">
            <input type="email" id="rEmail" class="auth-inp" placeholder="Email">
            <input type="text" id="rCode" class="auth-inp" placeholder="Promo Kod" style="text-align:center; font-weight:bold; border-color:var(--primary);">
            
            <button class="btn-login" id="bLogin" onclick="handleLogin()">Gƒ∞Rƒ∞≈û ET</button>
            <div id="loginErr" class="err-msg"></div>
            
            <a href="#" onclick="openWA('Promo Kod lazƒ±mdƒ±r')" class="wa-link"><i class="fa-brands fa-whatsapp"></i> Promo Kod Al</a>
        </div>
    </div>

    <div id="appScreen" class="hidden">
        
        <div class="app-header">
            <div class="logo">JETWIN</div>
            <div style="display:flex; align-items:center;">
                <div class="bal-display">$ <span id="uBal" class="bal-val">0.00</span></div>
                <button class="btn-withdraw" onclick="handleWithdraw()"><i class="fa-solid fa-wallet"></i></button>
            </div>
        </div>

        <div id="mainContainer">
            
            <div id="viewLobby" class="view-section active">
                <div class="lobby-hero" onclick="switchView('game')">
                    <h2>JETX PRO</h2>
                    <p>Canlƒ± Oyun ‚Ä¢ Y√ºks…ôk ∆èmsallar</p>
                    <i class="fa-solid fa-rocket"></i>
                </div>

                <div style="padding:0 15px; margin-bottom:10px; font-weight:bold; color:#ccc;">OYUNLAR</div>
                <div class="game-grid">
                    <div class="game-item" onclick="switchView('mines')">
                        <div class="g-img">üí£</div>
                        <div>MINES</div>
                    </div>
                    <div class="game-item" onclick="switchView('slots')">
                        <div class="g-img">üçí</div>
                        <div>SLOTS</div>
                    </div>
                    <div class="game-item" style="opacity:0.5;">
                        <div class="g-img">‚öΩ</div>
                        <div>PENALTY <i class="fa-solid fa-lock" style="font-size:12px;"></i></div>
                    </div>
                    <div class="game-item" style="opacity:0.5;">
                        <div class="g-img">üé≤</div>
                        <div>DICE <i class="fa-solid fa-lock" style="font-size:12px;"></i></div>
                    </div>
                </div>
            </div>

            <div id="viewGame" class="view-section">
                <div id="gameView">
                    <canvas id="jetCanvas"></canvas>
                    
                    <div class="jet-hud">
                        <div class="jet-multi" id="jMulti">1.00x</div>
                        <div class="jet-status" id="jStatus">G√ñZL∆èNƒ∞Lƒ∞R...</div>
                    </div>

                    <div class="game-controls">
                        <div class="bet-input-row">
                            <button class="bet-mod" onclick="modBet(-5)">-</button>
                            <input type="number" id="betInput" class="bet-inp" value="10" readonly>
                            <button class="bet-mod" onclick="modBet(5)">+</button>
                            <button class="bet-mod" style="width:auto; padding:0 10px; font-size:14px;" onclick="modBet(50)">+50</button>
                        </div>
                        <button id="btnJetPlay" class="action-btn btn-play" onclick="playJet()">M∆èRC ET</button>
                        <button id="btnJetCash" class="action-btn btn-cash" onclick="cashJet()">PULU G√ñT√úR</button>
                    </div>
                </div>
            </div>

            <div id="viewMines" class="view-section">
                <div class="mines-wrap">
                    <div style="margin-bottom:15px; font-size:20px; font-weight:bold; color:var(--green);" id="minesMsg">M∆èRC EDƒ∞N</div>
                    <div class="mines-grid-box" id="minesGrid"></div>
                    
                    <div style="width:100%; max-width:350px;">
                        <div class="bet-input-row">
                            <button class="bet-mod" onclick="modBetM(-5)">-</button>
                            <input type="number" id="mBetInput" class="bet-inp" value="10" readonly>
                            <button class="bet-mod" onclick="modBetM(5)">+</button>
                        </div>
                        <button id="btnMinePlay" class="action-btn btn-play" onclick="startMines()">OYNA</button>
                        <button id="btnMineCash" class="action-btn btn-cash" style="background:var(--green);" onclick="cashMines()">G√ñT√úR</button>
                    </div>
                </div>
            </div>

            <div id="viewSlots" class="view-section">
                <div class="slots-wrap">
                    <div class="slot-machine">
                        <div class="reels">
                            <div class="reel-col" id="reel1"><div class="sym">üçí</div></div>
                            <div class="reel-col" id="reel2"><div class="sym">üçã</div></div>
                            <div class="reel-col" id="reel3"><div class="sym">üçá</div></div>
                        </div>
                    </div>
                    <div id="slotRes" style="height:30px; margin:20px 0; font-weight:bold; font-size:20px; color:var(--primary);"></div>
                    
                    <div style="width:90%; max-width:350px;">
                        <div class="bet-input-row">
                            <button class="bet-mod" onclick="modBetS(-5)">-</button>
                            <input type="number" id="sBetInput" class="bet-inp" value="10" readonly>
                            <button class="bet-mod" onclick="modBetS(5)">+</button>
                        </div>
                        <button id="btnSlotSpin" class="action-btn btn-play" onclick="spinSlots()">FIRLAT</button>
                    </div>
                </div>
            </div>

            <div id="viewBonus" class="view-section">
                <div class="bonus-wrap">
                    <h2 style="color:var(--primary); font-family:'Rajdhani';">LUCKY WHEEL</h2>
                    <div class="wheel-container">
                        <div class="wheel-pointer"></div>
                        <div class="wheel-circle" id="wheelObj"></div>
                    </div>
                    <button id="btnWheel" class="action-btn btn-play" style="border-radius:30px;" onclick="doSpin()">FIRLAT</button>
                    <p id="wheelMsg" style="margin-top:20px; font-weight:bold;"></p>
                </div>
            </div>

        </div>

        <div class="btm-nav">
            <div class="nav-btn active" onclick="switchView('lobby')">
                <i class="fa-solid fa-house"></i> Lobby
            </div>
            <div class="nav-btn" onclick="switchView('mines')">
                <i class="fa-solid fa-bomb"></i> Mines
            </div>
            <div class="nav-mid" onclick="switchView('game')">
                <i class="fa-solid fa-rocket" style="font-size:24px;"></i>
            </div>
            <div class="nav-btn" onclick="switchView('slots')">
                <i class="fa-solid fa-lemon"></i> Slots
            </div>
            <div class="nav-btn" onclick="switchView('bonus')">
                <i class="fa-solid fa-gift"></i> Bonus
            </div>
        </div>

    </div>

    <script>
        // --- GLOBAL STATE ---
        let user = { name: "", email: "", balance: 0.00, deposit: 0, spinUsed: false };
        let audioCtx = null;

        // --- INIT ---
        window.onload = function() {
            if(localStorage.getItem('jw_v8')) {
                user = JSON.parse(localStorage.getItem('jw_v8'));
                showApp();
            } else {
                document.getElementById('authScreen').style.display = 'flex';
            }
        };

        function playSound(type) {
            if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            if(audioCtx.state === 'suspended') audioCtx.resume();
            
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            
            const t = audioCtx.currentTime;
            if(type === 'click') {
                osc.frequency.setValueAtTime(600, t);
                gain.gain.setValueAtTime(0.1, t);
                osc.start(t); osc.stop(t+0.05);
            } else if(type === 'win') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(400, t);
                osc.frequency.linearRampToValueAtTime(800, t+0.2);
                gain.gain.setValueAtTime(0.2, t);
                osc.start(t); osc.stop(t+0.4);
            } else if(type === 'lose') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, t);
                gain.gain.linearRampToValueAtTime(0, t+0.3);
                osc.start(t); osc.stop(t+0.3);
            }
        }

        function saveState() {
            localStorage.setItem('jw_v8', JSON.stringify(user));
            document.getElementById('uBal').innerText = user.balance.toFixed(2);
        }

        // --- AUTH ---
        async function handleLogin() {
            playSound('click');
            const n = document.getElementById('rName').value.trim();
            const e = document.getElementById('rEmail').value.trim();
            const c = document.getElementById('rCode').value.trim();
            const btn = document.getElementById('bLogin');
            const err = document.getElementById('loginErr');

            if(n.length < 3 || c.length < 2) { err.innerText = "M…ôlumatlarƒ± tam doldurun"; return; }
            
            btn.innerText = "Yoxlanƒ±lƒ±r...";
            try {
                let req = await fetch(`${API_URL}?action=login&name=${encodeURIComponent(n)}&email=${encodeURIComponent(e)}&code=${encodeURIComponent(c)}`);
                let res = await req.json();
                
                if(res.result === 'success') {
                    user = { name: n, email: e, balance: parseFloat(res.balance), deposit: parseFloat(res.balance), spinUsed: false };
                    saveState();
                    showApp();
                } else {
                    err.innerText = res.msg || "Kod yanlƒ±≈üdƒ±r";
                    btn.innerText = "Gƒ∞Rƒ∞≈û ET";
                }
            } catch(x) {
                err.innerText = "ƒ∞nternet x…ôtasƒ±";
                btn.innerText = "Gƒ∞Rƒ∞≈û ET";
            }
        }

        function showApp() {
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('appScreen').classList.remove('hidden');
            document.getElementById('uBal').innerText = user.balance.toFixed(2);
            if(user.spinUsed) document.getElementById('btnWheel').disabled = true;
            initMinesGrid(); // Draw empty grid
        }

        function handleWithdraw() {
            if(user.balance > user.deposit) {
                openWA(`ID: ${user.email}. Balans: $${user.balance}. √áƒ±xarƒ±≈ü etm…ôk ist…ôyir…ôm.`);
            } else {
                alert(`√áƒ±xarƒ±≈ü √º√ß√ºn balansƒ±nƒ±z ilkin depozitd…ôn ($${user.deposit}) √ßox olmalƒ±dƒ±r.`);
            }
        }

        function switchView(viewName) {
            playSound('click');
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            
            if(viewName === 'lobby') document.getElementById('viewLobby').classList.add('active');
            if(viewName === 'game') { document.getElementById('viewGame').classList.add('active'); initJetCanvas(); }
            if(viewName === 'mines') document.getElementById('viewMines').classList.add('active');
            if(viewName === 'slots') document.getElementById('viewSlots').classList.add('active');
            if(viewName === 'bonus') document.getElementById('viewBonus').classList.add('active');
        }

        // --- GAME 1: JETX (Fixed Logic) ---
        let jPlaying = false, jMulti = 1.0, jAnim, jStart;
        
        function initJetCanvas() {
            const cvs = document.getElementById('jetCanvas');
            const ctx = cvs.getContext('2d');
            const p = cvs.parentElement;
            cvs.width = p.offsetWidth;
            cvs.height = p.offsetHeight;
            
            // Static stars
            ctx.fillStyle = "#0b0f19"; ctx.fillRect(0,0,cvs.width,cvs.height);
            ctx.fillStyle = "rgba(255,255,255,0.3)";
            for(let i=0; i<40; i++) ctx.fillRect(Math.random()*cvs.width, Math.random()*cvs.height, 2, 2);
        }

        function modBet(v) { 
            let el = document.getElementById('betInput');
            let val = parseInt(el.value) + v;
            if(val < 1) val = 1;
            el.value = val;
        }

        function playJet() {
            let bet = parseInt(document.getElementById('betInput').value);
            if(user.balance < bet) { openWA('Depozit lazƒ±mdƒ±r'); return; }
            
            user.balance -= bet; saveState();
            jPlaying = true; jMulti = 1.0;
            
            document.getElementById('btnJetPlay').style.display = 'none';
            document.getElementById('btnJetCash').style.display = 'block';
            document.getElementById('jStatus').innerText = "U√áU≈û BA≈ûLADI...";
            document.getElementById('jStatus').style.color = "#fff";
            document.getElementById('jMulti').classList.remove('crashed', 'win-anim');
            document.getElementById('jMulti').style.color = "white";

            // Rigged: 60% chance to crash low (1.0 - 1.5)
            let crash = Math.random() < 0.6 ? 1.0 + Math.random()*0.5 : 1.5 + Math.random()*5;
            
            jStart = Date.now();
            drawJet(crash);
        }

        function drawJet(crashVal) {
            if(!jPlaying) return;
            
            let t = (Date.now() - jStart) / 1000;
            jMulti = 1.00 + (t * t * 0.1);
            
            document.getElementById('jMulti').innerText = jMulti.toFixed(2) + "x";

            if(jMulti >= crashVal) {
                jPlaying = false;
                cancelAnimationFrame(jAnim);
                playSound('lose');
                document.getElementById('jMulti').classList.add('crashed');
                document.getElementById('jStatus').innerText = "PARTLADI!";
                document.getElementById('jStatus').style.color = "red";
                setTimeout(resetJet, 2000);
            } else {
                const cvs = document.getElementById('jetCanvas');
                const ctx = cvs.getContext('2d');
                ctx.clearRect(0,0,cvs.width,cvs.height);
                
                // Stars
                ctx.fillStyle = "rgba(255,255,255,0.3)";
                for(let i=0; i<10; i++) ctx.fillRect(Math.random()*cvs.width, Math.random()*cvs.height, 2, 2);

                // Rocket
                let x = Math.min(cvs.width - 50, t * 100);
                let y = cvs.height - Math.min(cvs.height - 50, (jMulti - 1) * 100);
                
                ctx.beginPath(); ctx.lineWidth = 4; ctx.strokeStyle = "#f59e0b";
                ctx.moveTo(0, cvs.height); ctx.quadraticCurveTo(x/2, cvs.height, x, y); ctx.stroke();
                
                ctx.save(); ctx.translate(x, y); ctx.rotate(-45 * Math.PI / 180);
                ctx.font = "30px Arial"; ctx.fillText("üöÄ", -15, 0); ctx.restore();

                jAnim = requestAnimationFrame(() => drawJet(crashVal));
            }
        }

        function cashJet() {
            if(!jPlaying) return;
            jPlaying = false;
            cancelAnimationFrame(jAnim);
            playSound('win');
            
            let bet = parseInt(document.getElementById('betInput').value);
            let win = bet * jMulti;
            user.balance += win; saveState();
            
            document.getElementById('jMulti').classList.add('win-anim');
            document.getElementById('jStatus').innerText = `QAZANDINIZ: $${win.toFixed(2)}`;
            document.getElementById('jStatus').style.color = "#10b981";
            
            // Sync
            fetch(`${API_URL}?action=win&name=${user.name}&email=${user.email}&amount=${win.toFixed(2)}`, {mode:'no-cors'});
            
            setTimeout(resetJet, 2000);
        }

        function resetJet() {
            document.getElementById('btnJetPlay').style.display = 'block';
            document.getElementById('btnJetCash').style.display = 'none';
            document.getElementById('jMulti').innerText = "1.00x";
            document.getElementById('jMulti').classList.remove('crashed', 'win-anim');
            document.getElementById('jStatus').innerText = "G√ñZL∆èNƒ∞Lƒ∞R...";
            initJetCanvas();
        }

        // --- GAME 2: MINES (Fixed Grid) ---
        let mActive = false, mMulti = 1.0, mBet = 10, mClicks = 0;
        
        function modBetM(v) { let el = document.getElementById('mBetInput'); let val = parseInt(el.value)+v; if(val<1)val=1; el.value=val; }

        function initMinesGrid() {
            const grid = document.getElementById('minesGrid');
            grid.innerHTML = "";
            for(let i=0; i<25; i++) {
                let div = document.createElement('div');
                div.className = 'mine-cell';
                div.id = `mc-${i}`;
                div.onclick = () => hitMine(i);
                grid.appendChild(div);
            }
        }

        function startMines() {
            mBet = parseInt(document.getElementById('mBetInput').value);
            if(user.balance < mBet) { openWA('Depozit lazƒ±mdƒ±r'); return; }
            
            user.balance -= mBet; saveState();
            mActive = true; mMulti = 1.0; mClicks = 0;
            
            document.getElementById('btnMinePlay').style.display = 'none';
            document.getElementById('btnMineCash').style.display = 'block';
            document.getElementById('btnMineCash').innerText = "G√ñT√úR";
            document.getElementById('minesMsg').innerText = "DA≈ûLARI SE√á...";
            document.getElementById('minesMsg').style.color = "var(--green)";
            
            initMinesGrid(); // Reset grid visual
        }

        function hitMine(idx) {
            if(!mActive) return;
            let cell = document.getElementById(`mc-${idx}`);
            if(cell.classList.contains('safe') || cell.classList.contains('boom')) return;

            // Rigged: 1st click 95% safe, 2nd 80%, 3rd+ 20% safe
            let boom = false;
            if(mClicks === 0) boom = Math.random() < 0.05;
            else if(mClicks === 1) boom = Math.random() < 0.2;
            else boom = Math.random() < 0.8;

            if(boom) {
                cell.classList.add('boom'); cell.innerHTML = "üí£";
                playSound('lose'); mActive = false;
                document.getElementById('minesMsg').innerText = "PARTLADI!";
                document.getElementById('minesMsg').style.color = "red";
                setTimeout(resetMines, 2000);
            } else {
                cell.classList.add('safe'); cell.innerHTML = "üíé";
                playSound('click');
                mClicks++;
                mMulti *= 1.25;
                document.getElementById('btnMineCash').innerText = `G√ñT√úR ($${(mBet*mMulti).toFixed(2)})`;
            }
        }

        function cashMines() {
            if(!mActive) return;
            let win = mBet * mMulti;
            user.balance += win; saveState();
            playSound('win');
            mActive = false;
            document.getElementById('minesMsg').innerText = `QAZANDIN: $${win.toFixed(2)}`;
            fetch(`${API_URL}?action=win&name=${user.name}&email=${user.email}&amount=${win.toFixed(2)}`, {mode:'no-cors'});
            resetMines();
        }

        function resetMines() {
            document.getElementById('btnMinePlay').style.display = 'block';
            document.getElementById('btnMineCash').style.display = 'none';
            initMinesGrid();
        }

        // --- GAME 3: SLOTS (Simple Logic) ---
        const syms = ["üçí","üçã","üçá","üíé","7Ô∏è‚É£"];
        function modBetS(v) { let el = document.getElementById('sBetInput'); let val = parseInt(el.value)+v; if(val<1)val=1; el.value=val; }

        function spinSlots() {
            let bet = parseInt(document.getElementById('sBetInput').value);
            if(user.balance < bet) { openWA('Depozit lazƒ±mdƒ±r'); return; }
            
            user.balance -= bet; saveState();
            playSound('click');
            
            let btn = document.getElementById('btnSlotSpin');
            btn.disabled = true;
            document.getElementById('slotRes').innerText = ".......";

            // Anim
            [1,2,3].forEach(i => {
                document.getElementById(`reel${i}`).innerHTML = `<div class='sym'>‚ùì</div>`;
            });

            setTimeout(() => {
                // Rigged: mostly lose
                let r = Math.random();
                let res = [0, 1, 2]; // Lose
                if(r < 0.2) res = [0, 0, 0]; // Small win
                
                [1,2,3].forEach((id, i) => {
                    document.getElementById(`reel${id}`).innerHTML = `<div class='sym'>${syms[res[i-1]]}</div>`;
                });

                btn.disabled = false;
                if(res[0] === res[1] && res[1] === res[2]) {
                    let win = bet * 3;
                    user.balance += win; saveState();
                    document.getElementById('slotRes').innerText = `WIN: $${win}`;
                    playSound('win');
                } else {
                    document.getElementById('slotRes').innerText = "UDUZDUNUZ";
                }
            }, 1000);
        }

        // --- GAME 4: BONUS ---
        function doSpin() {
            if(user.spinUsed) return;
            let btn = document.getElementById('btnWheel');
            btn.disabled = true;
            playSound('click');
            
            let wheel = document.getElementById('wheelObj');
            let isWin = Math.random() < 0.05; // 5% chance
            let deg = 1800 + (isWin ? 270 : 45); // 270 is Green ($1), 45 is Red (Empty)
            
            wheel.style.transform = `rotate(${deg}deg)`;
            
            setTimeout(() => {
                user.spinUsed = true;
                if(isWin) {
                    user.balance += 1;
                    document.getElementById('wheelMsg').innerText = "T∆èBRƒ∞KL∆èR! $1 QAZANDINIZ!";
                    playSound('win');
                } else {
                    document.getElementById('wheelMsg').innerText = "BO≈û! B…ôxtiniz g…ôtirm…ôdi.";
                }
                saveState();
            }, 4500);
        }

    </script>
</body>
</html>
